<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>schema.macros documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Schema</span> <span class="project-version">1.3.5</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></div></li><li class="depth-2 branch"><a href="schema.coerce.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coerce</span></div></a></li><li class="depth-2 branch"><a href="schema.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>experimental</span></div></div></li><li class="depth-3 branch"><a href="schema.experimental.abstract-map.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>abstract-map</span></div></a></li><li class="depth-3 branch"><a href="schema.experimental.complete.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>complete</span></div></a></li><li class="depth-3"><a href="schema.experimental.generators.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>generators</span></div></a></li><li class="depth-2 branch current"><a href="schema.macros.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>macros</span></div></a></li><li class="depth-2 branch"><a href="schema.potemkin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>potemkin</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>spec</span></div></div></li><li class="depth-3 branch"><a href="schema.spec.collection.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>collection</span></div></a></li><li class="depth-3 branch"><a href="schema.spec.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-3 branch"><a href="schema.spec.leaf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>leaf</span></div></a></li><li class="depth-3"><a href="schema.spec.variant.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>variant</span></div></a></li><li class="depth-2 branch"><a href="schema.test.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-2"><a href="schema.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="schema.macros.html#var-*compile-fn-validation*"><div class="inner"><span>*compile-fn-validation*</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-apply-prepost-conditions"><div class="inner"><span>apply-prepost-conditions</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-assert.21"><div class="inner"><span>assert!</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-cljs-env.3F"><div class="inner"><span>cljs-env?</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-compile-fn-validation.3F"><div class="inner"><span>compile-fn-validation?</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-defrecord-schema"><div class="inner"><span>defrecord-schema</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-emit-defrecord"><div class="inner"><span>emit-defrecord</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-error.21"><div class="inner"><span>error!</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-extract-arrow-schematized-element"><div class="inner"><span>extract-arrow-schematized-element</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-extract-schema-form"><div class="inner"><span>extract-schema-form</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-if-bb"><div class="inner"><span>if-bb</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-if-cljs"><div class="inner"><span>if-cljs</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-input-schema-form"><div class="inner"><span>input-schema-form</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-maybe-split-first"><div class="inner"><span>maybe-split-first</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-normalized-defn-args"><div class="inner"><span>normalized-defn-args</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-normalized-metadata"><div class="inner"><span>normalized-metadata</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-parse-arity-spec"><div class="inner"><span>parse-arity-spec</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-primitive-sym.3F"><div class="inner"><span>primitive-sym?</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-process-arrow-schematized-args"><div class="inner"><span>process-arrow-schematized-args</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-process-fn-"><div class="inner"><span>process-fn-</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-process-fn-arity"><div class="inner"><span>process-fn-arity</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-resolve-tag"><div class="inner"><span>resolve-tag</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-rest-arg-schema-form"><div class="inner"><span>rest-arg-schema-form</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-safe-get"><div class="inner"><span>safe-get</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-set-compile-fn-validation.21"><div class="inner"><span>set-compile-fn-validation!</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-simple-arglist-schema-form"><div class="inner"><span>simple-arglist-schema-form</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-single-arg-schema-form"><div class="inner"><span>single-arg-schema-form</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-split-rest-arg"><div class="inner"><span>split-rest-arg</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-try-catchall"><div class="inner"><span>try-catchall</span></div></a></li><li class="depth-1"><a href="schema.macros.html#var-validation-error"><div class="inner"><span>validation-error</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">schema.macros</h1><div class="doc"><pre class="plaintext">Macros and macro helpers used in schema.core.
</pre></div><div class="public anchor" id="var-*compile-fn-validation*"><h3>*compile-fn-validation*</h3><h4 class="dynamic">dynamic</h4><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L222">view source</a></div></div><div class="public anchor" id="var-apply-prepost-conditions"><h3>apply-prepost-conditions</h3><div class="usage"><code>(apply-prepost-conditions body)</code></div><div class="doc"><pre class="plaintext">Replicate pre/postcondition logic from clojure.core/fn.
</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L211">view source</a></div></div><div class="public anchor" id="var-assert.21"><h3>assert!</h3><h4 class="type">macro</h4><div class="usage"><code>(assert! form &amp; format-args)</code></div><div class="doc"><pre class="plaintext">Like assert, but throws a RuntimeException (in Clojure) and takes args to format.
</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L69">view source</a></div></div><div class="public anchor" id="var-cljs-env.3F"><h3>cljs-env?</h3><div class="usage"><code>(cljs-env? env)</code></div><div class="doc"><pre class="plaintext">Take the &amp;env from a macro, and tell whether we are expanding into cljs.
</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L10">view source</a></div></div><div class="public anchor" id="var-compile-fn-validation.3F"><h3>compile-fn-validation?</h3><div class="usage"><code>(compile-fn-validation? env fn-name)</code></div><div class="doc"><pre class="plaintext">Returns true if validation should be included at compile time, otherwise false.
Validation is elided for any of the following cases:
*   function has :never-validate metadata
*   *compile-fn-validation* is false
*   *assert* is false AND function is not :always-validate</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L224">view source</a></div></div><div class="public anchor" id="var-defrecord-schema"><h3>defrecord-schema</h3><h4 class="type">macro</h4><div class="usage"><code>(defrecord-schema n &amp; args)</code></div><div class="doc"><pre class="plaintext">Like defrecord for schema primitives, and also registers cross-platform print methods.
</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L79">view source</a></div></div><div class="public anchor" id="var-emit-defrecord"><h3>emit-defrecord</h3><div class="usage"><code>(emit-defrecord defrecord-constructor-sym env name field-schema &amp; more-args)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L356">view source</a></div></div><div class="public anchor" id="var-error.21"><h3>error!</h3><h4 class="type">macro</h4><div class="usage"><code>(error! s)</code><code>(error! s m)</code></div><div class="doc"><pre class="plaintext">Generate a cross-platform exception appropriate to the macroexpansion context
</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L48">view source</a></div></div><div class="public anchor" id="var-extract-arrow-schematized-element"><h3>extract-arrow-schematized-element</h3><div class="usage"><code>(extract-arrow-schematized-element env s)</code></div><div class="doc"><pre class="plaintext">Take a nonempty seq, which may start like [a ...] or [a :- schema ...], and return
a list of [first-element-with-schema-attached rest-elements]</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L147">view source</a></div></div><div class="public anchor" id="var-extract-schema-form"><h3>extract-schema-form</h3><div class="usage"><code>(extract-schema-form symbol)</code></div><div class="doc"><pre class="plaintext">Pull out the schema stored on a thing.  Public only because of its use in a public macro.
</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L140">view source</a></div></div><div class="public anchor" id="var-if-bb"><h3>if-bb</h3><h4 class="type">macro</h4><div class="usage"><code>(if-bb then else)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L22">view source</a></div></div><div class="public anchor" id="var-if-cljs"><h3>if-cljs</h3><h4 class="type">macro</h4><div class="usage"><code>(if-cljs then else)</code></div><div class="doc"><pre class="plaintext">Return then if we are generating cljs code and else for Clojure code.
<a href="https://groups.google.com/d/msg/clojurescript/iBY5HaQda4A/w1lAQi9_AwsJ">https://groups.google.com/d/msg/clojurescript/iBY5HaQda4A/w1lAQi9_AwsJ</a></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L15">view source</a></div></div><div class="public anchor" id="var-input-schema-form"><h3>input-schema-form</h3><div class="usage"><code>(input-schema-form regular-args rest-arg)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L205">view source</a></div></div><div class="public anchor" id="var-maybe-split-first"><h3>maybe-split-first</h3><div class="usage"><code>(maybe-split-first pred s)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L96">view source</a></div></div><div class="public anchor" id="var-normalized-defn-args"><h3>normalized-defn-args</h3><div class="usage"><code>(normalized-defn-args env macro-args)</code></div><div class="doc"><pre class="plaintext">Helper for defining defn-like macros with schemas.  Env is &amp;env
from the macro body.  Reads optional docstring, return type and
attribute-map and normalizes them into the metadata of the name,
returning the normalized arglist.  Based on
clojure.tools.macro/name-with-attributes.</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L412">view source</a></div></div><div class="public anchor" id="var-normalized-metadata"><h3>normalized-metadata</h3><div class="usage"><code>(normalized-metadata env imeta explicit-schema)</code></div><div class="doc"><pre class="plaintext">Take an object with optional metadata, which may include a :tag,
plus an optional explicit schema, and normalize the
object to have a valid Clojure :tag plus a :schema field.</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L124">view source</a></div></div><div class="public anchor" id="var-parse-arity-spec"><h3>parse-arity-spec</h3><div class="usage"><code>(parse-arity-spec spec)</code></div><div class="doc"><pre class="plaintext">Helper for schema.core/=&gt;*.
</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L344">view source</a></div></div><div class="public anchor" id="var-primitive-sym.3F"><h3>primitive-sym?</h3><div class="usage"></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L101">view source</a></div></div><div class="public anchor" id="var-process-arrow-schematized-args"><h3>process-arrow-schematized-args</h3><div class="usage"><code>(process-arrow-schematized-args env args)</code></div><div class="doc"><pre class="plaintext">Take an arg vector, in which each argument is followed by an optional :- schema,
and transform into an ordinary arg vector where the schemas are metadata on the args.</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L157">view source</a></div></div><div class="public anchor" id="var-process-fn-"><h3>process-fn-</h3><div class="usage"><code>(process-fn- env name fn-body)</code></div><div class="doc"><pre class="plaintext">Process the fn args into a final tag proposal, schema form, schema bindings, and fn form
</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L313">view source</a></div></div><div class="public anchor" id="var-process-fn-arity"><h3>process-fn-arity</h3><div class="usage"><code>(process-fn-arity env fn-name output-schema-sym bind-meta arity-form)</code><code>(process-fn-arity {[bind &amp; body] :arity-form, :keys [env fn-name output-schema-sym bind-meta ufv-sym]})</code></div><div class="doc"><pre class="plaintext">Process a single (bind &amp; body) form, producing an output tag, schema-form,
 and arity-form which has asserts for validation purposes added that are
 executed when turned on, and have very low overhead otherwise.
 tag? is a prospective tag for the fn symbol based on the output schema.
 schema-bindings are bindings to lift eval outwards, so we don't build the schema
 every time we do the validation.

:ufv-sym should name a local binding bound to `schema.utils/use-fn-validation`.

5-args arity is deprecated.</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L238">view source</a></div></div><div class="public anchor" id="var-resolve-tag"><h3>resolve-tag</h3><div class="usage"><code>(resolve-tag env tag)</code></div><div class="doc"><pre class="plaintext">Given a Symbol, attempt to return a valid Clojure tag else nil.

Symbols not contained in `primitive-sym?` will be resolved. Symbols
resolved to Vars have their values checked in an attempt to provide
type hints when possible.

A valid tag is a primitive, Class, or Var containing a Class.</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L104">view source</a></div></div><div class="public anchor" id="var-rest-arg-schema-form"><h3>rest-arg-schema-form</h3><div class="usage"><code>(rest-arg-schema-form arg)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L196">view source</a></div></div><div class="public anchor" id="var-safe-get"><h3>safe-get</h3><h4 class="type">macro</h4><div class="usage"><code>(safe-get m k)</code></div><div class="doc"><pre class="plaintext">Like get but throw an exception if not found. A macro for historical reasons (to
work around cljx function placement restrictions).</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L60">view source</a></div></div><div class="public anchor" id="var-set-compile-fn-validation.21"><h3>set-compile-fn-validation!</h3><div class="usage"><code>(set-compile-fn-validation! on?)</code></div><div class="doc"><pre class="plaintext">Globally turn on or off function validation from being compiled into s/fn and s/defn.
Enabled by default.
See (doc compile-fn-validation?) for all conditions which control fn validation compilation</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L427">view source</a></div></div><div class="public anchor" id="var-simple-arglist-schema-form"><h3>simple-arglist-schema-form</h3><div class="usage"><code>(simple-arglist-schema-form rest? regular-args)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L193">view source</a></div></div><div class="public anchor" id="var-single-arg-schema-form"><h3>single-arg-schema-form</h3><div class="usage"><code>(single-arg-schema-form rest? [index arg])</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L186">view source</a></div></div><div class="public anchor" id="var-split-rest-arg"><h3>split-rest-arg</h3><div class="usage"><code>(split-rest-arg env bind)</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L171">view source</a></div></div><div class="public anchor" id="var-try-catchall"><h3>try-catchall</h3><h4 class="type">macro</h4><div class="usage"><code>(try-catchall &amp; body)</code></div><div class="doc"><pre class="plaintext">A cross-platform variant of try-catch that catches all* exceptions.
Does not (yet) support finally, and does not need or want an exception class.

*On the JVM certain fatal exceptions are not caught.</pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L26">view source</a></div></div><div class="public anchor" id="var-validation-error"><h3>validation-error</h3><h4 class="type">macro</h4><div class="usage"><code>(validation-error schema value expectation &amp; [fail-explanation])</code></div><div class="doc"><pre class="plaintext"></pre></div><div class="src-link"><a href="https://github.com/plumatic/schema/blob/17ba149d0f70a73dfa3e76444c7253caf14d2172/src/clj/schema/macros.clj#L75">view source</a></div></div></div></body></html>